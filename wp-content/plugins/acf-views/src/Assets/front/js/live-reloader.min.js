(()=>{function e(e){var t=i();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}function t(e){var i="function"==typeof Map?new Map:void 0;return t=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,s)}function s(){return n(e,arguments,r(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),o(s,e)},t(e)}function n(e,t,r){return n=i()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&o(r,n.prototype),r},n.apply(null,arguments)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(o=i.key,r=void 0,r=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"),"symbol"===s(r)?r:String(r)),i)}var o,r}function d(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var c,l,h,f,p,v,m="green",y="orange",g="red",b="blue",w=function(){function e(t,n,i,o,r){a(this,e),this.isDebugMode=!1,this.items={},this.nonce=t,this.postId=n,this.postHash=i,this.indicator=document.createElement("div"),this.isInactive=!1,this.isMouseMoved=!1,this.idGeneratorData=[],this.isDebugMode=r,this.nextRequestTimerId=0,this.timeouts=o,this.ajaxRequestTime=new Date,this.debug("Initialized",{timeouts:this.timeouts}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.setup.bind(this)):this.setup()}return d(e,[{key:"debug",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!1!==this.isDebugMode&&(t._time=(new Date).toISOString(),console.log("AVF Live Reload: "+e,t))}},{key:"removeItemsWithParentCardId",value:function(e){var t=this;Object.keys(this.items).forEach((function(n){var i=t.items[n];e===i.parentCardId&&delete t.items[n]}))}},{key:"getStylesRoot",value:function(){return window.avfStylesRoot||document}},{key:"getCssTag",value:function(e){return this.getStylesRoot().querySelector("style[data-advanced-views-asset="+e+"]")}},{key:"updateTag",value:function(e,t,n){if(null!==n){var i="style"===e?this.getCssTag(t):document.querySelector(e+"[data-advanced-views-asset="+t+"]");if(null===i&&""!==n)(i=document.createElement(e)).setAttribute("data-advanced-views-asset",t),("style"===e?this.getStylesRoot():document.head).appendChild(i);null!==i&&(i.innerHTML=n)}}},{key:"processChangedItems",value:function(e){var t=this,n=[];Object.keys(e).forEach((function(i){if(!1!==t.items.hasOwnProperty(i)){var o=t.items[i],r=e[i].codeHashes||{},s=!0===e[i].hasOwnProperty("css")?e[i].css:null,a=!0===e[i].hasOwnProperty("js")?e[i].js:null,u=!0===e[i].hasOwnProperty("html")?e[i].html:null;o.uniqueId.startsWith("card_")&&""===o.parentCardId&&t.removeItemsWithParentCardId(i),o.codeHashes=r,!1===n.includes(i)&&(t.updateTag("style",o.uniqueId,s),t.updateTag("script",o.uniqueId,a)),null!==u&&(o.element.outerHTML=u,o.element=o.reload_element.nextElementSibling),n.push(i),t.debug("Updated item",{itemId:i,isCssChanged:null!==s,isJsChanged:null!==a,isHtmlChanged:null!==u,data:e[i]})}else console.log("Advanced Views Framework - changed item with id: "+i+" not found.")}));var i=Object.keys(e).length;i>0&&this.debug("Updated items",{changedItemsCount:i,newItemsLength:Object.keys(this.items).length})}},{key:"processResponse",value:function(e){if(this.debug("Server responded",{_requestTimeInSeconds:((new Date).getTime()-this.ajaxRequestTime.getTime())/1e3,data:e}),e.hasOwnProperty("error"))return console.error("Advanced Views Framework - Rest API request error:",e.error),void this.updateIndicatorColor(g);!0!==e.hasOwnProperty("isPageChanged")?(this.processChangedItems(e.changedItems),!0!==this.isInactive&&(this.updateIndicatorColor(m),this.scheduleRequest(this.timeouts.REFRESH))):window.location.reload()}},{key:"makeRefreshRequest",value:function(){var e=this;this.updateIndicatorColor(y);var t={};Object.keys(this.items).forEach((function(n){var i=e.items[n];t[n]={unique_id:i.uniqueId,code_hashes:i.codeHashes,parent_card_id:i.parentCardId,shortcode_arguments:i.shortcodeArguments,is_gutenberg_block:i.isGutenbergBlock}}));var n={post_id:this.postId,post_hash:this.postHash,items:t};this.debug("Sending request",n),this.ajaxRequestTime=new Date,fetch("/wp-json/acf_views/v1/live-reloader",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":this.nonce},body:JSON.stringify(n)}).then((function(e){return e.json()})).then(this.processResponse.bind(this)).catch((function(t){return function(){console.error("Advanced Views Framework - Rest API request error:",t),e.updateIndicatorColor(g)}}))}},{key:"scheduleRequest",value:function(e){var t=this;!0!==this.isInactive?this.nextRequestTimerId=setTimeout((function(){t.nextRequestTimerId=0,t.makeRefreshRequest()}),e):this.debug("Skipping request scheduling due to the inactive mode")}},{key:"updateIndicatorColor",value:function(e){this.indicator.style.backgroundColor=e}},{key:"addItem",value:function(e){!1===this.idGeneratorData.hasOwnProperty(e.uniqueId)&&(this.idGeneratorData[e.uniqueId]=0),this.idGeneratorData[e.uniqueId]++;var t=e.uniqueId+"_"+this.idGeneratorData[e.uniqueId];this.items[t]=e}},{key:"setup",value:function(){var e=this;Object.assign(this.indicator.style,{width:"10px",height:"10px",position:"fixed",bottom:"20px",left:"20px",zIndex:"9999",backgroundColor:m,borderRadius:"50%"}),document.body.append(this.indicator),document.addEventListener("mousemove",(function(){e.isMouseMoved=!0,!1!==e.isInactive&&(e.debug("Leaving inactive mode"),e.isInactive=!1,e.makeRefreshRequest())})),setInterval((function(){if(e.isInactive=!1===e.isMouseMoved,e.isMouseMoved=!1,!1!==e.isInactive){if(window.innerWidth<992)return e.isInactive=!1,void e.debug("Skipping inactive mode due to the mobile view");0!==e.nextRequestTimerId&&(clearTimeout(e.nextRequestTimerId),e.nextRequestTimerId=0,e.debug("Request timer cleared while entering the inactive mode")),e.debug("Entering inactive mode"),e.updateIndicatorColor(b)}}),this.timeouts.INACTIVE),this.scheduleRequest(this.timeouts.REFRESH)}}]),e}(),I=null,R=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(i,t);var n=e(i);function i(){return a(this,i),n.apply(this,arguments)}return d(i,[{key:"connectedCallback",value:function(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.setup.bind(this)):this.setup()}},{key:"setup",value:function(){var e={};try{e=JSON.parse(this.dataset.element)}catch(e){return void console.error("Advanced Views Framework: error parsing live-reloading data attribute.")}I.addItem({uniqueId:e.uniqueId||"",codeHashes:e.codeHashes||"",parentCardId:e.parentCardId||"",shortcodeArguments:e.shortcodeArguments||{},isGutenbergBlock:e.isGutenbergBlock||!1,reload_element:this,element:this.nextElementSibling})}}]),i}(t(HTMLElement));c=window.avfLiveReloading.nonce||"",l=window.avfLiveReloading.isDevMode||!1,h=window.avfLiveReloading.interval||5,f=window.avfLiveReloading.inactiveDelay||20,p=window.avfLiveReloading.postId||"",v=window.avfLiveReloading.postHash||"",""!==c?(I=new w(c,p,v,{REFRESH:1e3*h,INACTIVE:1e3*f},l),customElements.define("avf-live-reloader",R)):console.error("Advanced Views Framework: data for live reloading is not set.")})();